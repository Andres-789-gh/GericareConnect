<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Paciente - GeriCare Connect</title>
    <link rel="stylesheet" href="../../admin/css_admin/agregar_paciente.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem 2rem; }
        .info-box { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; padding: 10px 15px; border-radius: 4px; margin-bottom: 15px; }
        .error-box { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 10px 15px; border-radius: 4px; margin-top: 15px; }
        .success-box { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; padding: 10px 15px; border-radius: 4px; margin-top: 15px; }
        #feedback-container { margin-top: 15px; text-align: left; }
    </style>
</head>
<body>
    <header class="admin-header animated fadeInDown">
        <div class="logo-container">
            <img src="../../imagenes/Geri_Logo-..png" alt="Logo de la aplicación" class="logo" onclick="window.location.href='admin_pacientes.html'">
            <span class="app-name">GERICARE CONNECT</span>
        </div>
        <nav>
            <ul>
                <li><a href="admin_pacientes.html"><i class="fas fa-user-injured"></i> Pacientes</a></li>
                <li><a href="admin_solicitudes.html"><i class="fas fa-envelope-open-text"></i> Solicitudes</a></li>
                <li><a href="../../../controllers/admin/logout.php"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
            </ul>
        </nav>
    </header>
    <main class="admin-content">
        <div class="agregar-paciente-container animated fadeInUp">
            <h1 class="animated slideInLeft"><i class="fas fa-user-plus"></i> Agregar Nuevo Paciente</h1>

            <div id="feedback-container"></div>

            <form id="formulario-agregar-paciente" class="agregar-paciente-form">
                <!-- Campos ocultos para IDs de solicitud y familiar -->
                <input type="hidden" id="solicitud_origen_id" name="solicitud_origen_id" value="">
                <input type="hidden" id="familiar_solicitante_id" name="familiar_solicitante_id" value="">
                
                <div class="form-grid">
                    <!-- Columna 1 -->
                    <div class="form-column">
                        <div class="form-group">
                            <label for="nombre"><i class="fas fa-user"></i> Nombres:</label>
                            <input type="text" id="nombre" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="apellido"><i class="fas fa-user"></i> Apellidos:</label>
                            <input type="text" id="apellido" name="apellido" required>
                        </div>
                        <div class="form-group">
                            <label for="documento_identificacion"><i class="fas fa-id-card"></i> Número de Documento:</label>
                            <input type="number" id="documento_identificacion" name="documento_identificacion" required>
                        </div>
                        <div class="form-group">
                            <label for="fecha_nacimiento"><i class="fas fa-calendar-alt"></i> Fecha de Nacimiento:</label>
                            <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required>
                        </div>
                        <div class="form-group">
                            <label for="genero"><i class="fas fa-venus-mars"></i> Género:</label>
                            <select id="genero" name="genero" required>
                                <option value="">Seleccione...</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="contacto_emergencia"><i class="fas fa-phone-alt"></i> Contacto de Emergencia:</label>
                            <input type="text" id="contacto_emergencia" name="contacto_emergencia">
                        </div>
                    </div>
                    <!-- Columna 2 -->
                    <div class="form-column">
                        <div class="form-group">
                            <label for="estado_civil"><i class="fas fa-ring"></i> Estado Civil:</label>
                             <select id="estado_civil" name="estado_civil" required>
                                <option value="">Seleccione...</option>
                                <option value="Soltero/a">Soltero/a</option>
                                <option value="Casado/a">Casado/a</option>
                                <option value="Viudo/a">Viudo/a</option>
                                <option value="Divorciado/a">Divorciado/a</option>
                                <option value="Unión Libre">Unión Libre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipo_sangre"><i class="fas fa-tint"></i> Tipo de Sangre:</label>
                            <select id="tipo_sangre" name="tipo_sangre" required>
                                <option value="">Seleccione...</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seguro_medico"><i class="fas fa-file-medical"></i> Seguro Médico:</label>
                            <input type="text" id="seguro_medico" name="seguro_medico">
                        </div>
                        <div class="form-group">
                            <label for="numero_seguro"><i class="fas fa-hashtag"></i> Número de Seguro:</label>
                            <input type="text" id="numero_seguro" name="numero_seguro">
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-button animated fadeInUp">
                    <i class="fas fa-save"></i> Guardar Paciente
                </button>
            </form>
        </div>
    </main>

    <script>
        document.getElementById('formulario-agregar-paciente').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevenir el envío tradicional del formulario
            enviarFormulario();
        });

        function enviarFormulario() {
            const formulario = document.getElementById('formulario-agregar-paciente');
            const feedbackContainer = document.getElementById('feedback-container');
            const formData = new FormData(formulario);
            const submitButton = formulario.querySelector('.submit-button');

            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
            feedbackContainer.innerHTML = '';

            fetch('../../../controllers/admin/agregar_paciente_procesar.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    feedbackContainer.innerHTML = `<div class="success-box"><p>${data.message}</p></div>`;
                    formulario.reset();
                    // Opcional: Redirigir o cerrar después de un tiempo
                    setTimeout(() => {
                        window.location.href = 'admin_pacientes.html';
                    }, 2000);
                } else {
                    feedbackContainer.innerHTML = `<div class="error-box"><p><b>Error al guardar:</b><br>${data.message}</p></div>`;
                }
            })
            .catch(error => {
                console.error('Error en fetch:', error);
                feedbackContainer.innerHTML = `<div class="error-box"><p>Error de conexión. Revisa la consola para más detalles.</p></div>`;
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-save"></i> Guardar Paciente';
            });
        }
    </script>
</body>
</html>
